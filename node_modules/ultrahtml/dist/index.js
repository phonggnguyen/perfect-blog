var P=0,k=1,I=2,L=3,$=4,T={img:1,br:1,hr:1,meta:1,link:1,base:1,input:1},x=/([\@\.a-z0-9_\:\-]*)\s*?=?\s*?(['"]?)(.*?)\2\s+/gim,c=/(?:<(\/?)([a-zA-Z][a-zA-Z0-9\:-]*)(?:\s([^>]*?))?((?:\s*\/)?)>|(<\!\-\-)([\s\S]*?)(\-\->)|(<\!)([\s\S]*?)(>))/gm;function v(t){let e={},r;if(t)for(x.lastIndex=0,t=" "+(t||"")+" ";r=x.exec(t);)r[0]!==" "&&(e[r[1]]=r[3]);return e}function _(t){let e=typeof t=="string"?t:t.value,r,o,n,i,a,l,u,d,s,p=[];c.lastIndex=0,o=r={type:0,children:[]};let N=0;function O(){i=e.substring(N,c.lastIndex-n[0].length),i&&o.children.push({type:2,value:i,parent:o})}for(;n=c.exec(e);)l=n[5]||n[8],u=n[6]||n[9],d=n[7]||n[10],l==="<!--"?(a=c.lastIndex-n[0].length,s={type:3,value:u,parent:o,loc:[{start:a,end:a+l.length},{start:c.lastIndex-d.length,end:c.lastIndex}]},p.push(s),s.parent.children.push(s)):l==="<!"?(a=c.lastIndex-n[0].length,s={type:4,value:u,parent:o,loc:[{start:a,end:a+l.length},{start:c.lastIndex-d.length,end:c.lastIndex}]},p.push(s),s.parent.children.push(s)):n[1]!=="/"?(O(),s={type:1,name:n[2]+"",attributes:v(n[3]),parent:o,children:[],loc:[{start:c.lastIndex-n[0].length,end:c.lastIndex}]},p.push(s),s.parent.children.push(s),n[4]&&n[4].indexOf("/")>-1||T.hasOwnProperty(s.name)?(s.loc[1]=s.loc[0],s.isSelfClosingTag=!0):o=s):(O(),n[2]+""===o.name?(s=o,o=s.parent,s.loc.push({start:c.lastIndex-n[0].length,end:c.lastIndex}),i=e.substring(s.loc[0].end,s.loc[1].start),s.children.length===0&&s.children.push({type:2,value:i,parent:o})):n[2]+""===p[p.length-1].name&&p[p.length-1].isSelfClosingTag===!0&&(s=p[p.length-1],s.loc.push({start:c.lastIndex-n[0].length,end:c.lastIndex}))),N=c.lastIndex;return i=e.slice(N),o.children.push({type:2,value:i,parent:o}),r}var g=class{constructor(e){this.callback=e}async visit(e,r,o){if(await this.callback(e,r,o),Array.isArray(e.children)){let n=[];for(let i=0;i<e.children.length;i++){let a=e.children[i];n.push(this.visit(a,e,i))}await Promise.all(n)}}},y=class{constructor(e){this.callback=e}visit(e,r,o){if(this.callback(e,r,o),Array.isArray(e.children))for(let n=0;n<e.children.length;n++){let i=e.children[n];this.visit(i,e,n)}}},f=Symbol("HTMLString"),b=Symbol("AttrString");function E(t,e=[f]){let r={value:t};for(let o of e)Object.defineProperty(r,o,{value:!0,enumerable:!1,writable:!1});return r}function j(t){return E(t)}var C={"&":"&amp;","<":"&lt;",">":"&gt;"};function w(t){return t.replace(/[&<>]/g,e=>C[e]||e)}function h(t){let e="";for(let[r,o]of Object.entries(t))e+=` ${r}="${o}"`;return E(e,[f,b])}function V(t,...e){let r="";for(let o=0;o<t.length;o++){r+=t[o];let n=e[o];r.endsWith("...")&&n&&typeof n=="object"?(r=r.slice(0,-3).trimEnd(),r+=h(n).value):n&&n[b]?(r=r.trimEnd(),r+=n.value):n&&n[f]?r+=n.value:typeof n=="string"?r+=w(n):(n||n===0)&&(r+=String(n))}return E(r)}function X(t,e){return new g(e).visit(t)}function q(t,e){return new y(e).visit(t)}function S({components:t={},sanitize:e=!0}){var r;if(e===!0)return{allowElements:Object.keys(t),dropElements:["script"],allowComponents:!1,allowCustomElements:!1,allowComments:!1};if(e===!1)return{dropElements:[],allowComponents:!0,allowCustomElements:!0,allowComments:!0};{let o=new Set([]);(r=e.allowElements)!=null&&r.includes("script")||o.add("script");for(let n of e.dropElements??[])o.add(n);return{allowComponents:!1,allowCustomElements:!1,allowComments:!1,...e,allowElements:[...Object.keys(t),...e.allowElements??[]],dropElements:Array.from(o)}}}function R(t){return t.name.includes("-")?"custom-element":/[\_\$A-Z]/.test(t.name[0])||t.name.includes(".")?"component":"element"}function A(t,e,r){var o,n,i;return((o=r.allowElements)==null?void 0:o.length)>0&&r.allowElements.includes(t)?"allow":((n=r.blockElements)==null?void 0:n.length)>0&&r.blockElements.includes(t)?"block":((i=r.dropElements)==null?void 0:i.length)>0&&r.dropElements.find(a=>a===t)||e==="component"&&!r.allowComponents||e==="custom-element"&&!r.allowCustomElements?"drop":"allow"}function M(t,e){var o,n,i,a,l,u;let r=t.attributes;for(let d of Object.keys(t.attributes))((o=e.allowAttributes)==null?void 0:o[d])&&((n=e.allowAttributes)==null?void 0:n[d].includes(t.name))||((i=e.allowAttributes)==null?void 0:i[d].includes("*"))||(((a=e.dropAttributes)==null?void 0:a[d])&&((l=e.dropAttributes)==null?void 0:l[d].includes(t.name))||((u=e.dropAttributes)==null?void 0:u[d].includes("*")))&&delete r[d];return r}async function D(t,e){let r=R(t),{name:o}=t,n=A(o,r,e.sanitize);if(n==="drop")return"";if(n==="block")return await Promise.all(t.children.map(l=>m(l,e))).then(l=>l.join(""));let i=e.components[t.name];if(typeof i=="string")return D({...t,name:i},e);let a=M(t,e.sanitize);if(typeof i=="function"){let l=await i(a,E(await Promise.all(t.children.map(u=>m(u,e))).then(u=>u.join(""))));return l&&l[f]?l.value:w(String(l))}return T.hasOwnProperty(o)?`<${t.name}${h(a).value}>`:`<${t.name}${h(a).value}>${await Promise.all(t.children.map(l=>m(l,e))).then(l=>l.join(""))}</${t.name}>`}async function m(t,e={}){let r=S(e);switch(t.type){case 0:return Promise.all(t.children.map(o=>m(o,e))).then(o=>o.join(""));case 1:return D(t,{components:e.components??{},sanitize:r});case 2:return`${t.value}`;case 3:return r.allowComments?`<!--${t.value}-->`:"";case 4:return`<!${t.value}>`}}async function H(t,e={}){return m(_(t),e)}export{L as COMMENT_NODE,$ as DOCTYPE_NODE,P as DOCUMENT_NODE,k as ELEMENT_NODE,I as TEXT_NODE,j as __unsafeHTML,h as attrs,V as html,_ as parse,m as render,H as transform,X as walk,q as walkSync};
